<!DOCTYPE html>
<html lang="zh-cn">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, shrink-to-fit=no" />
    <meta name="renderer" content="webkit" />
    <meta name="x-allow-anonymous" content="{{.AllowAnonymous}}" />
    <link rel="stylesheet" href="static/mdui/css/mdui.min.css" />
    <link rel="stylesheet" href="static/highlight/styles/github.min.css" />
    <title>{{.SiteName}} 管理面板</title>
</head>

<body class="mdui-theme-primary-indigo mdui-theme-accent-pink">
    <div class="mdui-appbar">
        <div class="mdui-toolbar mdui-color-theme">
            <a href="javascript:;" class="mdui-typo-title">{{.SiteName}} 管理面板</a>
            <div class="mdui-toolbar-spacer"></div>
            <a href="/" class="mdui-btn mdui-btn-icon" id="account-dialog-btn" mdui-tooltip="{content: '返回主页'}">
                <i class="mdui-icon material-icons">exit_to_app</i>
            </a>
        </div>
    </div>
    <div class="mdui-container mdui-p-a-1">
        <div class="mdui-panel" mdui-panel>
            <div class="mdui-panel-item mdui-panel-item-open">
                <div class="mdui-panel-item-header">添加用户</div>
                <div class="mdui-panel-item-body">
                    <div class="mdui-textfield">
                        <input id="admin-email-text" class="mdui-textfield-input" type="text" placeholder="Email" />
                    </div>
                    <div class="mdui-textfield">
                        <input id="admin-username-text" class="mdui-textfield-input" type="text" placeholder="User Name" />
                    </div>
                    <div class="mdui-textfield">
                        <input id="admin-password-text" class="mdui-textfield-input" type="text" placeholder="Password" />
                    </div>
                    <div class="mdui-textfield">
                        <input id="admin-group-text" class="mdui-textfield-input" type="text" placeholder="User Group" />
                    </div>
                    <button onclick="adduser()" class="mdui-btn mdui-btn-raised mdui-color-theme-accent mdui-ripple mdui-btn-block">确认添加</button>
                </div>
            </div>
        </div>
    </div>
</body>
<script src="static/mdui/js/mdui.min.js"></script>
<script>
    var $ = mdui.$;
    function adduser() {
    const email = $("#admin-email-text")[0].value;
    const username = $("#admin-username-text")[0].value;
    const password = $("#admin-password-text")[0].value;
    const group = $("#admin-group-text")[0].value;

    if (!email || !username || !password || !group) {
        mdui.alert('请填写所有字段');
        return;
    }

    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
        mdui.alert('请输入有效的电子邮件地址');
        return;
    }

    $.ajax({
        method: 'POST',
        url: '../api/adduser',
        data: JSON.stringify({
            "email": email,
            "username": username,
            "password": password,
            "group": group
        }),
        contentType: "application/json",
    }).then(res => {
        let response = JSON.parse(res);
        if (response.code != 0){
            mdui.alert(response.error);
        } else {
            mdui.alert('添加成功');
        }
    });
}
</script>

</html>